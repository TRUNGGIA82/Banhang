<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Qu·∫£n L√Ω Gi√° H√†ng</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body { font-family: Arial; margin:0; background:#f2f2f2; }
.header { background:#2f80ed; color:white; padding:15px; text-align:center; font-weight:bold; }
.container { padding:15px; margin-bottom:80px; }
input, select, button, textarea {
    width:100%; padding:10px; margin:5px 0;
    border-radius:8px; border:1px solid #ccc;
    font-size:16px;
}
button { background:#2f80ed; color:white; border:none; }
.card {
    background:white; padding:12px; border-radius:10px;
    margin-bottom:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);
}
.price-le { font-size:26px; color:#27ae60; font-weight:bold; }
.price-si { color:#2980b9; }
.stock-low { color:orange; }
.stock-out { color:red; }
.nav {
    position:fixed; bottom:0; width:100%;
    display:flex; background:white; border-top:1px solid #ccc;
}
.nav button { flex:1; padding:10px; background:white; color:#333; }
.hidden { display:none; }
textarea { height:120px; }
#reader { margin-top:10px; }
</style>
</head>
<body>

<div class="header">Qu·∫£n L√Ω Gi√° H√†ng</div>

<div id="view-search" class="container">
    <input type="text" id="searchInput" placeholder="T√¨m t√™n / m√£ / barcode">
    <button onclick="startScanner()">üì∑ Qu√©t Barcode</button>
    <div id="reader" class="hidden"></div>
    <div id="result"></div>
</div>

<div id="view-products" class="container hidden">
    <h3>Danh s√°ch s·∫£n ph·∫©m</h3>
    <div id="productList"></div>
</div>

<div id="view-import" class="container hidden">
    <h3>Import (Copy - D√°n)</h3>
    <p>ƒê·ªãnh d·∫°ng: ma,ten,barcode,gia_le,gia_si,ton</p>
    <textarea id="importData"></textarea>
    <button onclick="importProducts()">Import</button>
</div>

<div id="view-nhap" class="container hidden">
    <h3>Nh·∫≠p h√†ng</h3>
    <select id="nhapProduct"></select>
    <input type="number" id="nhapSoLuong" placeholder="S·ªë l∆∞·ª£ng nh·∫≠p">
    <button onclick="nhapHang()">C·∫≠p nh·∫≠t t·ªìn kho</button>
</div>

<div class="nav">
    <button onclick="showView('search')">Gi√°</button>
    <button onclick="showView('products')">S·∫£n ph·∫©m</button>
    <button onclick="showView('import')">Import</button>
    <button onclick="showView('nhap')">Nh·∫≠p</button>
</div>

<script>

let products = JSON.parse(localStorage.getItem("products")) || [
{ma:"SP001", ten:"S·ªØa Vinamilk 1L", barcode:"8938505974198", gia_le:22000, gia_si:20000, ton:120},
{ma:"SP002", ten:"S·ªØa Vinamilk 180ml", barcode:"8938505974181", gia_le:7000, gia_si:6500, ton:8},
{ma:"SP003", ten:"Coca 330ml", barcode:"8934588590302", gia_le:10000, gia_si:9000, ton:0}
];

function saveData(){
localStorage.setItem("products", JSON.stringify(products));
}

function showView(view){
document.querySelectorAll(".container").forEach(v=>v.classList.add("hidden"));
document.getElementById("view-"+view).classList.remove("hidden");
renderProducts();
renderSelect();
}

function renderProducts(){
const list = document.getElementById("productList");
list.innerHTML="";
products.forEach(p=>{
let stockClass="";
if(p.ton==0) stockClass="stock-out";
else if(p.ton<10) stockClass="stock-low";
list.innerHTML+=`
<div class="card">
<b>${p.ten} (${p.ma})</b>
<div>Barcode: ${p.barcode}</div>
<div class="price-le">${p.gia_le.toLocaleString()}ƒë</div>
<div class="price-si">Gi√° s·ªâ: ${p.gia_si.toLocaleString()}ƒë</div>
<div class="${stockClass}">T·ªìn: ${p.ton}</div>
</div>`;
});
}

function renderSelect(){
const select = document.getElementById("nhapProduct");
select.innerHTML="";
products.forEach((p,i)=>{
select.innerHTML+=`<option value="${i}">${p.ten}</option>`;
});
}

document.getElementById("searchInput").addEventListener("input",function(){
searchProduct(this.value);
});

function searchProduct(keyword){
const key=keyword.toLowerCase();
const result=document.getElementById("result");
result.innerHTML="";
products.filter(p=>p.ten.toLowerCase().includes(key)||p.ma.toLowerCase().includes(key)||p.barcode.includes(key))
.forEach(p=>{
result.innerHTML+=`
<div class="card">
<b>${p.ten}</b>
<div class="price-le">${p.gia_le.toLocaleString()}ƒë</div>
<div class="price-si">S·ªâ: ${p.gia_si.toLocaleString()}ƒë</div>
<div>T·ªìn: ${p.ton}</div>
</div>`;
});
}

function importProducts(){
const data=document.getElementById("importData").value.trim();
if(!data) return;
const lines=data.split("\n");
lines.forEach(line=>{
let [ma,ten,barcode,gia_le,gia_si,ton]=line.split(",");
let existing=products.find(p=>p.ma==ma);
if(existing){
existing.ten=ten;
existing.barcode=barcode;
existing.gia_le=Number(gia_le);
existing.gia_si=Number(gia_si);
existing.ton=Number(ton);
}else{
products.push({ma,ten,barcode,gia_le:Number(gia_le),gia_si:Number(gia_si),ton:Number(ton)});
}
});
saveData();
alert("Import th√†nh c√¥ng!");
renderProducts();
renderSelect();
}

function nhapHang(){
const index=document.getElementById("nhapProduct").value;
const sl=Number(document.getElementById("nhapSoLuong").value);
if(!sl) return;
products[index].ton+=sl;
saveData();
alert("ƒê√£ c·∫≠p nh·∫≠t t·ªìn kho!");
renderProducts();
}

let html5QrCode;

function startScanner(){
document.getElementById("reader").classList.remove("hidden");
html5QrCode = new Html5Qrcode("reader");
Html5Qrcode.getCameras().then(devices=>{
if(devices && devices.length){
html5QrCode.start(devices[0].id,{fps:10,qrbox:250},
(decodedText)=>{
document.getElementById("searchInput").value=decodedText;
searchProduct(decodedText);
stopScanner();
});
}
});
}

function stopScanner(){
if(html5QrCode){
html5QrCode.stop().then(()=>{
document.getElementById("reader").classList.add("hidden");
});
}
}

renderProducts();
renderSelect();

</script>

</body>
</html>
